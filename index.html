<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Versus Mobile - Perfect 100 Edition</title>
    <style>
        /* スタイル部分は変更なし（あなたの元のデザインを維持） */
        :root { 
            --s: calc(100vh / 14); 
            --blue: #0040ff; --red: #ff0044; --gray: #444; --white: #eee;
            --rep: #0080ff; --bell: #eebb00; --suika: #00bb00; --cherry: #ff0000; --tok: #aa00ff;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        html, body { background: #000; color: #fff; font-family: sans-serif; margin: 0; height: 100svh; width: 100%; overflow: hidden; position: fixed; }
        header { display: flex; gap: 4px; padding: 6px; background: #111; flex-shrink: 0; }
        header label { flex: 1; height: 50px; }
        header input { display: none; }
        header span { display: flex; align-items: center; justify-content: center; height: 100%; border-radius: 6px; font-size: 14px; font-weight: bold; text-align: center; line-height: 1.2; opacity: 0.45; border: 2px solid transparent; transition: 0.1s; color: #fff; }
        .state-hazure span { background: var(--gray); }
        .state-x span { background: var(--blue); }
        .state-seven span { background: var(--red); }
        .state-reg span { background: #bbb; color: #000; }
        header input:checked + span { opacity: 1; border-color: #fff; transform: scale(0.98); }
        
        main { flex: 1; display: flex; justify-content: center; align-items: center; padding: 5px; overflow: hidden; gap: 2px; }
        .reel-col { flex: 1; max-width: 130px; display: flex; flex-direction: column; height: calc(var(--s) * 7); position: relative; pointer-events: auto; }
        
        .window { 
            flex: 1; background: #000; border: 2px solid #333; 
            position: relative; overflow-y: scroll; 
            scroll-snap-type: y mandatory;
            scroll-behavior: auto;
        }
        .window::-webkit-scrollbar { display: none; }
        #win-R { overflow-y: hidden; pointer-events: none; }
        
        .symbol { width: 100%; height: var(--s); scroll-snap-align: start; scroll-snap-stop: always; flex-shrink: 0; background-image: url('reel.png'); background-size: 100% 2100%; border-bottom: 1px solid #111; position: relative; }
        
        .frame { position: absolute; left: -6px; width: calc(100% + 12px); height: calc(var(--s) * 3); top: calc(var(--s) * 2); z-index: 100; pointer-events: none; border: 8px solid transparent; }
        #win-L-frame { border-color: rgba(0, 64, 255, 0.8); }
        #win-R-frame { border-color: rgba(255, 0, 68, 0.8); }

        .info { width: 85px; display: flex; flex-direction: column; gap: 6px; flex-shrink: 0; padding: 0 2px; }
        .badge { background: #111; border: 1.5px solid #444; padding: 4px 0; border-radius: 6px; text-align: center; }
        .badge span { font-size: 9px; color: #888; display: block; font-weight: bold; }
        .badge b { font-size: 22px; color: #fff; line-height: 1.2; font-family: monospace; }
        #val-slip { color: #ff0; font-size: 30px; }

        nav { display: grid; grid-template-columns: repeat(5, 1fr); gap: 3px; padding: 6px; background: #111; flex-shrink: 0; }
        nav span { display: flex; align-items: center; justify-content: center; height: 42px; border-radius: 4px; font-size: 9px; text-align: center; line-height: 1.1; font-weight: bold; opacity: 0.45; border: 1px solid transparent; transition: 0.1s; color: #fff; }
        .f-hazure span { background: #666; }
        .f-rep span { background: var(--rep); color: #fff; }
        .f-bell span { background: var(--bell); color: #000; }
        .f-suika span { background: var(--suika); color: #fff; }
        .f-cherry span { background: var(--cherry); color: #fff; }
        nav input:checked + span { opacity: 1; border: 2px solid #fff; }
        nav input { display: none; }
        
        footer { height: 70px; padding: 8px; background: #111; flex-shrink: 0; border-top: 1px solid #333; }
        .btn-exec { width: 100%; height: 100%; background: #d32f2f; color: #fff; font-weight: bold; font-size: 18px; border: none; border-radius: 8px; }
    </style>
</head>
<body onload="init()">
<header>
    <label class="state-hazure"><input type="radio" name="state" value="hazure" checked><span>未成立</span></label>
    <label class="state-x"><input type="radio" name="state" value="don"><span>X成立</span></label>
    <label class="state-seven"><input type="radio" name="state" value="seven"><span>７成立</span></label>
    <label class="state-reg"><input type="radio" name="state" value="reg"><span>Reg成立</span></label>
</header>
<main>
    <div class="reel-col">
        <label style="position:absolute; top:-20px; font-size:10px;">操作リール</label>
        <select id="reelSelect" style="position:absolute; top:-35px; width:100%; background:#000; color:#fff;">
            <option value="left">左リール</option>
            <option value="middle">中リール</option>
            <option value="right">右リール</option>
        </select>
        <div id="win-L-frame" class="frame"></div>
        <div class="window" id="win-L"><div id="strip-L"></div></div>
    </div>
    <div class="info">
        <div class="badge"><span>狙い(中)</span><b id="val-cur">--</b></div>
        <div class="badge"><span>滑り</span><b id="val-slip">--</b></div>
        <div class="badge"><span>停止(中)</span><b id="val-res">--</b></div>
    </div>
    <div class="reel-col">
        <div id="win-R-frame" class="frame"></div>
        <div class="window" id="win-R"><div id="strip-R"></div></div>
    </div>
</main>
<nav>
    <label class="f-hazure"><input type="radio" name="flag" value="0" checked><span>ハズレ</span></label>
    <label class="f-rep"><input type="radio" name="flag" value="1"><span>リプ1</span></label>
    <label class="f-rep"><input type="radio" name="flag" value="2"><span>リプ2</span></label>
    <label class="f-rep"><input type="radio" name="flag" value="3"><span>リプ3</span></label>
    <label class="f-bell"><input type="radio" name="flag" value="4"><span>ベル1</span></label>
    <label class="f-bell"><input type="radio" name="flag" value="5"><span>ベル2</span></label>
    <label class="f-suika"><input type="radio" name="flag" value="6"><span>スイカ1</span></label>
    <label class="f-suika"><input type="radio" name="flag" value="7"><span>スイカ2</span></label>
    <label class="f-cherry"><input type="radio" name="flag" value="8"><span>チェB</span></label>
    <label class="f-cherry"><input type="radio" name="flag" value="9"><span>チェA</span></label>
</nav>
<footer><button class="btn-exec" onclick="executeControl()">解析実行</button></footer>

<script>
    // 先ほど2人で突き合わせた「100点満点」の整理済みデータ
    const GOD_DATA = {
        left: {
            hazure: [[1,0,0,0,1,1,2,2,4,4,0,2,0,2,2],[1,3,3,3,0,1,1,1,3,3,1,1,0,0,0],[1,2,2,2,2,2,3,3,2,2,3,3,3,3,3],[4,1,1,1,1,4,4,4,4,4,4,2,4,0,2],[3,0,0,0,3,3,3,3,4,4,3,1,3,0,1],[2,1,1,1,2,2,2,2,3,3,2,0,2,0,0],[1,0,0,0,1,1,1,1,2,2,1,1,1,1,1],[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0],[3,3,3,3,3,3,4,4,0,0,4,4,4,3,4],[3,2,2,2,3,2,4,4,1,1,3,3,3,3,3],[1,1,1,1,1,4,2,2,0,0,2,2,2,2,2],[1,0,0,0,1,0,2,2,2,2,1,1,1,0,1],[1,2,2,2,1,0,0,0,1,1,0,0,0,1,0],[0,1,1,1,1,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,2,1,1,4,4,1,1,1,3,1],[0,1,1,1,2,1,1,1,3,3,2,2,2,2,2],[1,0,0,0,0,1,0,0,2,2,1,1,1,1,1],[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0],[3,3,3,3,3,4,3,3,0,0,3,4,3,4,4],[3,2,2,2,3,2,4,4,1,1,3,3,3,4,3],[1,1,1,1,1,1,1,1,0,0,1,3,1,2,3]],
            don: [[1,0,1,0,1,2,2,2,4,4,2,1,0,2,2],[1,3,0,3,0,0,1,1,3,3,1,1,0,0,0],[1,2,3,2,2,0,3,3,2,2,3,1,3,3,3],[4,1,1,1,1,2,2,2,1,1,2,2,2,2,2],[3,0,1,0,3,1,2,2,4,4,2,1,1,1,1],[2,1,4,1,2,0,1,1,3,3,1,0,2,0,0],[1,0,0,0,1,1,1,1,2,2,1,1,1,1,1],[4,4,4,4,4,0,0,0,1,1,0,4,0,4,4],[3,3,4,3,3,3,4,4,0,0,4,3,4,4,4],[3,2,0,2,3,2,4,4,1,1,4,3,3,3,3],[1,1,2,1,1,1,2,2,0,0,2,1,2,2,2],[1,0,1,0,1,0,2,2,2,2,2,1,1,1,1],[1,2,0,2,1,1,0,0,1,1,0,1,0,0,0],[0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,1,1,1,1,4,4,1,0,1,1,1],[0,1,4,1,2,1,1,1,3,3,1,0,2,2,2],[1,0,1,0,0,1,0,0,2,2,0,1,1,1,1],[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0],[3,3,1,3,3,4,3,3,0,0,3,4,3,4,4],[3,2,4,2,3,4,4,4,1,1,4,3,3,3,3],[1,1,1,1,1,2,1,1,0,0,1,3,1,3,3]],
            seven: [[1,0,1,0,1,2,2,2,4,4,2,1,0,2,2],[1,3,0,3,0,0,1,1,3,3,1,1,0,0,0],[1,2,3,2,2,0,3,3,2,2,3,1,3,3,3],[4,1,1,1,1,2,2,2,1,1,2,2,2,2,2],[3,0,1,0,3,1,2,2,4,4,2,1,1,1,1],[2,1,4,1,2,0,1,1,3,3,1,0,2,0,0],[1,0,0,0,1,1,1,1,2,2,1,1,1,1,1],[4,4,4,4,4,0,0,0,1,1,0,4,0,4,4],[3,3,4,3,3,3,4,4,0,0,4,3,4,4,4],[3,2,0,2,3,2,4,4,1,1,4,3,3,3,3],[1,1,2,1,1,1,2,2,0,0,2,1,2,2,2],[1,0,1,0,1,0,2,2,2,2,2,1,1,1,1],[1,2,0,2,1,1,0,0,1,1,0,1,0,0,0],[0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,1,1,1,1,4,4,1,0,1,1,1],[0,1,4,1,2,1,1,1,3,3,1,0,2,2,2],[1,0,1,0,0,1,0,0,2,2,0,1,1,1,1],[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0],[3,3,1,3,3,4,3,3,0,0,3,4,3,4,4],[3,2,4,2,3,4,4,4,1,1,4,3,3,3,3],[1,1,1,1,1,2,1,1,0,0,1,3,1,3,3]],
            reg: [[1,0,0,0,1,1,2,2,4,4,0,2,0,2,2],[1,3,3,3,0,1,1,1,3,3,1,1,0,0,0],[1,2,2,2,2,2,3,3,2,2,3,3,3,3,3],[4,1,1,1,1,4,4,4,4,4,4,2,4,0,2],[3,0,0,0,3,3,3,3,4,4,3,1,3,0,1],[2,1,1,1,2,2,2,2,3,3,2,0,2,0,0],[1,0,0,0,1,1,1,1,2,2,1,1,1,1,1],[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0],[3,3,3,3,3,3,4,4,0,0,4,4,4,3,4],[3,2,2,2,3,2,4,4,1,1,3,3,3,3,3],[1,1,1,1,1,4,2,2,0,0,2,2,2,2,2],[1,0,0,0,1,0,2,2,2,2,1,1,1,0,1],[1,2,2,2,1,0,0,0,1,1,0,0,0,1,0],[0,1,1,1,1,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,2,1,1,4,4,1,1,1,3,1],[0,1,1,1,2,1,1,1,3,3,2,2,2,2,2],[1,0,0,0,0,1,0,0,2,2,1,1,1,1,1],[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0],[3,3,3,3,3,4,3,3,0,0,3,4,3,4,4],[3,2,2,2,3,2,4,4,1,1,3,3,3,4,3],[1,1,1,1,1,1,1,1,0,0,1,3,1,2,3]]
        },
        middle: {
            hazure: [[3,0,0,0,4,4,1,1,1,1],[0,4,4,4,3,3,2,2,0,0],[1,3,3,3,2,2,1,1,4,4],[3,2,2,2,1,1,0,0,3,3],[3,1,1,1,0,0,3,3,2,2],[1,0,0,0,3,3,2,2,1,1],[1,3,3,3,2,2,0,0,4,4],[3,2,2,2,1,1,0,0,3,3],[3,1,1,1,0,0,2,2,2,2],[1,0,0,0,3,3,1,1,1,1],[1,3,3,3,2,2,4,4,0,0],[3,2,2,2,1,1,4,4,3,3],[2,1,1,1,0,0,2,2,2,2],[3,0,0,0,4,4,2,2,1,1],[0,4,4,4,3,3,0,0,0,0],[1,3,3,3,2,2,0,0,1,1],[0,2,2,2,1,1,0,0,0,0],[2,1,1,1,0,0,2,2,2,2],[1,0,0,0,2,2,4,4,1,1],[0,2,2,2,1,1,3,3,0,0],[2,1,1,1,0,0,2,2,2,2]],
            don: [[1,0,0,0,4,4,1,1,1,1,1,1,1,3,1],[4,4,4,4,3,3,1,1,0,0,4,4,4,4,4],[4,3,3,3,2,2,0,0,4,4,4,4,4,3,4],[3,2,2,2,1,1,0,0,3,3,4,4,4,2,4],[2,1,1,1,0,0,2,2,2,2,3,3,3,1,3],[1,0,0,0,3,3,1,1,1,1,0,0,0,2,0],[0,3,3,3,2,2,0,0,4,4,0,0,0,0,0],[0,2,2,2,1,1,0,0,3,3,0,0,0,0,0],[0,1,1,1,0,0,0,0,2,2,2,2,2,2,2],[1,0,0,0,3,3,1,1,1,1,2,4,4,4,2],[2,3,3,3,2,2,4,4,0,0,4,3,3,3,1],[4,2,2,2,1,1,4,4,3,3,4,2,2,3,0],[0,1,1,1,0,0,2,2,2,2,4,2,4,1,4],[4,0,0,0,4,4,2,2,1,1,3,1,3,1,3],[1,4,4,4,3,3,1,1,0,0,0,0,0,0,0],[2,3,3,3,2,2,0,0,1,1,1,0,1,0,1],[1,2,2,2,1,1,0,0,0,0,0,0,0,0,0],[1,1,1,1,0,0,1,1,2,2,2,2,2,1,2],[2,0,0,0,2,2,4,4,1,1,4,0,4,1,0],[3,2,2,2,1,1,3,3,0,0,4,0,4,0,0],[0,1,1,1,0,0,2,2,2,2,2,2,2,1,2]],
            seven: [[2,0,0,0,4,4,1,1,1,1,1,0,1,1,1],[1,4,4,4,3,3,2,2,0,0,4,4,4,4,4],[0,3,3,3,2,2,1,1,4,4,0,3,0,0,4],[4,2,2,2,1,1,0,0,3,3,4,2,4,4,4],[3,1,1,1,0,0,3,3,2,2,3,3,3,3,3],[2,0,0,0,3,3,2,2,1,1,0,0,0,0,0],[4,3,3,3,2,2,0,0,4,4,0,1,0,4,0],[3,2,2,2,1,1,0,0,3,3,0,0,0,4,0],[2,1,1,1,0,0,2,2,2,2,2,1,2,2,2],[4,0,0,0,3,3,4,4,1,1,4,4,4,4,4],[4,3,3,3,2,2,4,4,0,0,4,3,3,3,3],[3,2,2,2,1,1,4,4,3,3,4,2,2,2,2],[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2],[2,0,0,0,4,4,2,2,1,1,1,0,1,1,1],[0,4,4,4,3,3,0,0,0,0,0,0,0,0,0],[0,3,3,3,2,2,0,0,0,0,0,0,0,0,0],[3,2,2,2,1,1,0,0,0,0,0,2,0,0,0],[2,1,1,1,0,0,2,2,2,2,2,1,2,2,2],[1,0,0,0,2,2,4,4,1,1,4,1,4,0,0],[0,2,2,2,1,1,3,3,0,0,4,2,4,0,0],[3,1,1,1,0,0,2,2,2,2,2,4,2,2,2]],
            reg: [[1,0,0,0,4,4,1,1,1,1,1,1,1,1,1],[0,4,4,4,3,3,0,0,0,0,0,4,0,0,4],[3,3,3,3,3,2,2,1,1,4,4,3,3,3,3,3],[4,2,2,2,1,1,0,0,3,3,2,2,2,2,2],[1,1,1,1,0,0,1,1,2,2,3,3,3,3,3],[2,0,0,0,3,3,2,2,1,1,0,0,0,0,0],[4,3,3,3,2,2,4,4,4,4,1,1,1,4,1],[3,2,2,2,1,1,3,3,3,3,0,0,0,3,0],[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2],[1,0,0,0,3,3,1,1,1,1,4,4,4,4,4],[0,3,3,3,2,2,4,4,0,0,4,3,3,3,3],[3,2,2,2,1,1,3,3,3,3,4,2,2,2,2],[2,1,1,1,0,0,2,2,2,2,2,2,2,2,2],[1,0,0,0,4,4,1,1,1,1,1,1,1,1,1],[0,4,4,4,3,3,0,0,0,0,1,1,1,1,1],[0,3,3,3,2,2,0,0,0,0,0,0,0,0,0],[3,2,2,2,1,1,0,0,0,0,0,2,0,2,2],[2,1,1,1,0,0,2,2,2,2,1,1,1,1,1],[1,0,0,0,2,2,4,4,1,1,4,0,4,0,0],[0,2,2,2,1,1,4,4,0,0,3,3,3,3,3],[1,1,1,1,0,0,3,3,2,2,2,2,2,2,2]]
        },
        right: {
            hazure: [[3,2,3,2,1,1,1,1,3,3],[2,1,2,1,0,0,2,2,2,2],[1,0,1,0,3,3,4,4,3,3],[0,4,0,4,2,2,2,2,2,2],[2,3,4,3,1,1,2,2,1,1],[1,2,3,2,0,0,0,0,0,0],[0,1,2,1,3,3,0,0,1,1],[3,0,1,0,2,2,4,4,0,0],[3,2,0,2,1,1,0,0,3,3],[1,1,2,1,0,0,4,4,2,2],[1,0,1,0,3,3,3,3,1,1],[0,4,0,4,2,2,0,0,0,0],[4,3,4,3,1,1,4,4,4,4],[3,2,3,2,0,0,0,0,3,3],[2,1,2,1,4,4,4,4,2,2],[1,0,1,0,3,3,1,1,3,3],[0,3,0,3,2,2,2,2,2,2],[2,2,3,2,1,1,3,3,1,1],[2,1,2,1,0,0,0,0,0,0],[0,0,1,0,3,3,3,3,3,3],[0,3,0,3,2,2,0,0,2,2]],
            don: [[3,2,3,2,1,1,3,3,3,3,1,1,1,1,1],[0,1,2,1,0,0,0,0,2,2,2,2,2,2,2],[1,0,1,0,3,3,1,1,3,3,1,1,1,1,1],[0,4,0,4,2,2,0,0,2,2,0,0,0,0,0],[1,3,4,3,1,1,1,1,1,1,2,2,2,0,2],[0,2,3,2,0,0,0,0,0,0,0,4,4,4,0],[2,1,2,1,3,3,2,2,1,1,0,4,4,3,0],[2,0,1,0,2,2,4,4,0,0,2,2,2,2,2],[0,2,0,2,1,1,0,0,3,3,2,2,2,1,2],[0,1,2,1,0,0,2,2,2,2,4,0,0,0,4],[3,0,1,0,3,3,3,3,1,1,3,3,3,1,3],[0,4,0,4,2,2,0,0,0,0,2,2,2,0,2],[1,3,4,3,1,1,1,1,4,4,3,3,3,0,3],[3,2,3,2,0,0,3,3,3,3,0,0,0,4,0],[4,1,2,1,4,4,4,4,2,2,1,1,1,3,1],[1,0,1,0,3,3,1,1,3,3,0,0,0,2,0],[2,3,0,3,2,2,2,2,2,2,2,2,2,1,2],[3,2,3,2,1,1,3,3,1,1,3,3,3,0,3],[4,1,2,1,0,0,4,4,0,0,4,4,4,4,4],[3,0,1,0,3,3,3,3,3,3,3,3,3,3,3],[2,3,0,3,2,2,2,2,2,2,2,2,2,2,2]],
            seven: [[1,2,3,2,1,1,1,1,3,3,1,0,1,1,1],[2,1,2,1,0,0,2,2,2,2,0,3,2,2,2],[4,0,1,0,3,3,4,4,3,3,2,1,2,3,3],[3,4,0,4,2,2,2,2,2,2,3,1,3,3,3],[2,3,4,3,1,1,2,2,1,1,2,3,2,1,2],[3,2,3,2,0,0,0,0,0,0,0,4,4,4,0],[0,1,2,1,3,3,0,0,1,1,0,3,4,4,0],[1,0,1,0,2,2,4,4,0,0,2,2,2,2,2],[0,2,0,2,1,1,0,0,3,3,2,3,2,2,2],[4,1,2,1,0,0,4,4,4,4,4,4,4,0,4],[3,0,1,0,3,3,3,3,3,3,3,3,3,1,3],[2,4,0,4,2,2,2,2,2,2,2,2,2,2,2],[3,3,4,3,1,1,1,1,1,1,3,1,1,3,3],[0,2,3,2,0,0,0,0,0,0,0,0,0,0,0],[0,1,2,1,4,4,4,4,1,1,1,1,1,1,1],[0,0,1,0,3,3,1,1,3,3,0,0,0,0,0],[2,3,0,3,2,2,2,2,2,2,2,0,2,2,2],[3,2,3,2,1,1,3,3,1,1,3,3,3,3,3],[0,1,2,1,0,0,0,0,0,0,0,2,0,0,0],[1,0,1,0,3,3,3,3,3,3,3,2,3,3,3],[0,3,0,3,2,2,0,0,2,2,2,1,2,2,2]],
            reg: [[1,1,1,1,1,1,1,0,0,1,3,1,2,3],[3,2,2,2,3,2,4,4,1,1,3,3,3,4,3],[3,3,3,3,3,4,3,3,0,0,3,4,3,4,4],[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0],[1,0,0,0,0,1,0,0,2,2,1,1,1,1,1],[0,1,1,1,2,1,1,1,3,3,2,2,2,2,2],[0,0,0,0,1,2,1,1,4,4,1,1,1,3,1],[0,1,1,1,1,4,0,0,0,0,0,0,0,0,0],[1,2,2,2,1,0,0,0,1,1,0,0,0,1,0],[1,0,0,0,1,0,2,2,2,2,1,1,1,0,1],[1,1,1,1,1,4,2,2,0,0,2,2,2,2,2],[3,2,2,2,3,2,4,4,1,1,3,3,3,3,3],[3,3,3,3,3,3,4,4,0,0,4,4,4,3,4],[0,4,4,4,4,0,0,0,1,1,0,0,0,0,0],[1,0,0,0,1,1,1,1,2,2,1,1,1,1,1],[2,1,1,1,2,2,2,2,3,3,2,0,2,0,0],[3,0,0,0,3,3,3,3,4,4,3,1,3,0,1],[4,1,1,1,1,4,4,4,4,4,4,2,4,0,2],[1,2,2,2,2,2,3,3,2,2,3,3,3,3,3],[1,3,3,3,0,1,1,1,3,3,1,1,0,0,0],[1,0,0,0,1,1,2,2,4,4,0,2,0,2,2]]
        }
    };

    let sH = 0;
    let selectedIdx = 21;

    function init() {
        build('strip-L');
        build('strip-R');
        const winL = document.getElementById('win-L');
        
        setTimeout(() => {
            sH = document.querySelector('.symbol').offsetHeight;
            winL.scrollTop = 21 * sH;
            updateCurrentPos();
        }, 100);

        winL.addEventListener('wheel', (e) => {
            e.preventDefault();
            const direction = e.deltaY > 0 ? 1 : -1;
            winL.scrollTop += direction * sH;
        }, { passive: false });

        winL.onscroll = () => {
            if (winL.scrollTop < 5 * sH) winL.scrollTop += 21 * sH;
            if (winL.scrollTop > 40 * sH) winL.scrollTop -= 21 * sH;
            updateCurrentPos();
        };
    }

    function updateCurrentPos() {
        const winL = document.getElementById('win-L');
        let centerPos = winL.scrollTop + (sH * 2.5);
        let rawIdx = Math.floor(centerPos / sH);
        selectedIdx = 21 - (rawIdx % 21);
        if (selectedIdx === 0) selectedIdx = 21;
        document.getElementById('val-cur').innerText = selectedIdx;
    }

    function build(id) {
        const target = document.getElementById(id);
        for(let s=0; s<3; s++) for(let i=21; i>=1; i--) {
            const d = document.createElement('div'); d.className = 'symbol'; 
            d.style.backgroundPosition = `0 ${(21-i)*5}%`; target.appendChild(d);
        }
    }

    function executeControl() {
        const reel = document.getElementById('reelSelect').value;
        const state = document.querySelector('input[name="state"]:checked').value;
        const flagIdx = parseInt(document.querySelector('input[name="flag"]:checked').value);
        
        // 狙い位置（中段番号）
        const pos = selectedIdx;
        
        // 【重要】整理済みデータ配列は 21番(idx 0) から 1番(idx 20) の降順。
        // インデックス計算: 21 - pos
        const arrayIdx = 21 - pos; 
        
        // 選択されたフラグの列からスベリ数を取得
        const reelData = GOD_DATA[reel][state][arrayIdx];
        const slip = reelData[flagIdx];
        
        // 停止位置の計算（中段）
        let stopMid = pos + slip;
        if(stopMid > 21) stopMid -= 21;
        
        document.getElementById('val-slip').innerText = slip;
        document.getElementById('val-res').innerText = stopMid;

        const winR = document.getElementById('win-R');
        // 表示のズレを補正して右リール（結果表示用）をスクロール
        const targetTop = (21 + (21 - stopMid) - 3) * sH;
        winR.scrollTo({ top: targetTop, behavior: 'auto' });
    }
</script>
</body>
</html>