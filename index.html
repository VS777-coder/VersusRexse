<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Versus Revise - Final Auditor</title>
    <style>
        :root { --sH: 60px; --blue: #00bbff; --red: #ff3333; --rep: #0080ff; --bell: #eebb00; --suika: #00bb00; --cherry: #ff0000; --tok: #aa00ff; }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background: #000; color: #fff; font-family: sans-serif; height: 100svh; overflow: hidden; display: flex; flex-direction: column; position: fixed; width: 100%; }
        
        header { background: #111; padding: 6px; flex-shrink: 0; }
        .group { display: flex; gap: 4px; margin-bottom: 4px; }
        .btn { flex: 1; height: 42px; border-radius: 6px; font-size: 11px; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 2px solid #444; background: #222; color: #fff; opacity: 0.4; cursor: pointer; }
        .btn.active { opacity: 1; border-color: #0f0; box-shadow: 0 0 10px rgba(0,255,0,0.4); }

        main { flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; background: #000; overflow: hidden; }
        .reel-container { position: relative; width: 105px; height: calc(var(--sH) * 5); background: #111; border: 1px solid #333; overflow: hidden; border-radius: 4px; }
        .win { width: 100%; height: 100%; overflow-y: scroll; scrollbar-width: none; scroll-snap-type: y mandatory; }
        .win::-webkit-scrollbar { display: none; }
        .frame { position: absolute; top: var(--sH); left: 0; width: 100%; height: calc(var(--sH) * 3); z-index: 99; pointer-events: none; border: 5px solid var(--blue); }
        .frame.red { border-color: var(--red); }
        .strip { display: flex; flex-direction: column; }
        .symbol { width: 100%; height: var(--sH); background-size: 100% 2100%; background-repeat: no-repeat; }
        
        .info { width: 85px; text-align: center; display: flex; flex-direction: column; gap: 10px; }
        .box { background: #111; border: 1px solid #333; padding: 5px; border-radius: 4px; }
        .val { font-size: 18px; font-weight: bold; }
        #val-slip { font-size: 36px; color: #ff0; line-height: 1; }

        .flag-grid { padding: 8px; background: #111; display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; flex-shrink: 0; }
        .f-btn { height: 38px; border-radius: 5px; font-size: 9px; font-weight: bold; border: 1px solid #333; color: #fff; display: flex; align-items: center; justify-content: center; text-align: center; cursor: pointer; }
        .f-btn.active { border: 2px solid #fff; box-shadow: 0 0 8px #fff; }

        footer { padding: 8px 12px 12px; background: #000; }
        .exec { width: 100%; height: 52px; background: linear-gradient(#f44, #800); border-radius: 10px; color: #fff; font-size: 20px; font-weight: bold; border: 2px solid #f99; }
    </style>
</head>
<body>

<header>
    <div class="group">
        <div id="rb-left" class="btn active" onclick="setReel('left')">左リール</div>
        <div id="rb-middle" class="btn" onclick="setReel('middle')">中リール</div>
        <div id="rb-right" class="btn" onclick="setReel('right')">右リール</div>
    </div>
    <div class="group">
        <div id="st-hazure" class="btn active" onclick="setState('hazure')">ボーナス未成立</div>
        <div id="st-don" class="btn" onclick="setState('don')" style="color:#4af">Xビッグ成立</div>
        <div id="st-seven" class="btn" onclick="setState('seven')" style="color:#f44">7ビッグ成立</div>
        <div id="st-reg" class="btn" onclick="setState('reg')">REG成立</div>
    </div>
</header>

<main>
    <div class="reel-container"><div class="frame"></div><div class="win" id="winL"><div id="stripL" class="strip"></div></div></div>
    <div class="info">
        <div class="box">押下<div id="val-mid" class="val">--</div></div>
        <div class="box">滑り<div id="val-slip">--</div></div>
        <div class="box">停止<div id="val-res" class="val">--</div></div>
    </div>
    <div class="reel-container"><div class="frame red"></div><div class="win" id="winR" style="overflow:hidden;"><div id="stripR" class="strip"></div></div></div>
</main>

<div class="flag-grid">
    <div class="f-btn active" onclick="setFlag(0, this)" style="background:#444">ハズレ</div>
    <div class="f-btn" onclick="setFlag(1, this)" style="background:var(--rep)">リプレイ</div>
    <div class="f-btn" onclick="setFlag(2, this)" style="background:var(--rep)">JACリプ</div>
    <div class="f-btn" onclick="setFlag(3, this)" style="background:var(--rep)">RTリプ</div>
    <div class="f-btn" onclick="setFlag(4, this)" style="background:var(--bell)">ベルA</div>
    <div class="f-btn" onclick="setFlag(5, this)" style="background:var(--bell)">ベルB</div>
    <div class="f-btn" onclick="setFlag(6, this)" style="background:var(--suika)">スイカA</div>
    <div class="f-btn" onclick="setFlag(7, this)" style="background:var(--suika)">スイカB</div>
    <div class="f-btn" onclick="setFlag(8, this)" style="background:var(--cherry)">チェリーA</div>
    <div class="f-btn" onclick="setFlag(9, this)" style="background:var(--cherry)">チェリーB</div>
    <div class="f-btn" onclick="setFlag(10, this)" style="background:var(--tok)">特殊役A</div>
    <div class="f-btn" onclick="setFlag(11, this)" style="background:var(--tok)">特殊役B</div>
    <div class="f-btn" onclick="setFlag(12, this)" style="background:var(--tok)">特殊役C</div>
    <div class="f-btn" onclick="setFlag(13, this)" style="background:var(--tok)">特殊役D</div>
    <div class="f-btn" onclick="setFlag(14, this)" style="background:var(--tok)">特殊役E</div>
</div>

<footer><button class="exec" onclick="executeControl()">解 析 実 行</button></footer>

<script>
    const sH = 60;
    let selectedIdx = 8;
    let currentState = 'hazure';
    let currentReel = 'left';
    let selectedFlagIdx = 0;
    const reelArray = [21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1];

    const GOD_DATA = {
        left: {
            hazure: [[21, [2, 1, 2, 1, 1, 1, 1, 1, 0, 0, null, null, null, null, null]], [20, [4, 2, 0, 2, 3, 3, 4, 4, 1, 1, null, null, null, null, null]], [19, [4, 3, 1, 3, 3, 3, 3, 3, 0, 0, null, null, null, null, null]], [18, [0, 4, 2, 4, 4, 4, 0, 0, 1, 1, null, null, null, null, null]], [17, [1, 0, 3, 0, 0, 0, 0, 0, 2, 2, null, null, null, null, null]], [16, [1, 1, 0, 0, 2, 2, 1, 1, 3, 3, null, null, null, null, null]], [15, [1, 0, 0, 1, 1, 1, 1, 1, 4, 4, null, null, null, null, null]], [14, [0, 1, 2, 1, 1, 1, 4, 4, 0, 0, null, null, null, null, null]], [13, [1, 2, 2, 2, 1, 1, 0, 0, 1, 1, null, null, null, null, null]], [12, [0, 0, 4, 0, 1, 1, 2, 2, 2, 2, null, null, null, null, null]], [11, [1, 1, 2, 1, 1, 1, 2, 2, 0, 0, null, null, null, null, null]], [10, [2, 2, 3, 2, 3, 3, 4, 4, 1, 1, null, null, null, null, null]], [9,  [3, 3, 4, 3, 3, 3, 4, 4, 0, 0, null, null, null, null, null]], [8,  [0, 4, 2, 4, 4, 4, 0, 0, 1, 1, null, null, null, null, null]], [7,  [1, 0, 3, 0, 1, 1, 1, 1, 2, 2, null, null, null, null, null]], [6,  [0, 1, 0, 0, 2, 2, 1, 1, 3, 3, null, null, null, null, null]], [5,  [1, 0, 1, 1, 3, 3, 2, 2, 4, 4, null, null, null, null, null]], [4,  [2, 1, 1, 1, 1, 1, 2, 2, 1, 1, null, null, null, null, null]], [3,  [0, 2, 3, 2, 2, 2, 3, 3, 2, 2, null, null, null, null, null]], [2,  [0, 3, 3, 3, 0, 0, 1, 1, 3, 3, null, null, null, null, null]], [1,  [2, 0, 1, 0, 1, 1, 2, 2, 4, 4, null, null, null, null, null]]],
            don: [[21, [1,0,1,0,1,2,2,2,4,4,null,null,null,null,null]], [20, [1,3,0,3,0,0,1,1,3,3,null,null,null,null,null]], [19, [1,2,3,2,2,0,3,3,2,2,null,null,null,null,null]], [18, [4,1,1,1,1,2,2,2,1,1,null,null,null,null,null]], [17, [3,0,1,0,3,1,2,2,4,4,null,null,null,null,null]], [16, [2,1,4,1,2,0,1,1,3,3,null,null,null,null,null]], [15, [1,0,0,0,1,1,1,1,2,2,null,null,null,null,null]], [14, [4,4,4,4,4,0,0,0,1,1,null,null,null,null,null]], [13, [3,3,4,3,3,3,4,4,0,0,null,null,null,null,null]], [12, [3,2,0,2,3,2,4,4,1,1,null,null,null,null,null]], [11, [1,1,2,1,1,1,2,2,0,0,null,null,null,null,null]], [10, [1,0,1,0,1,0,2,2,2,2,null,null,null,null,null]], [9,  [1,2,0,2,1,1,0,0,1,1,null,null,null,null,null]], [8,  [0,1,1,1,1,0,0,0,0,0,null,null,null,null,null]], [7,  [0,0,2,0,1,1,1,1,4,4,null,null,null,null,null]], [6,  [0,1,4,1,2,1,1,1,3,3,null,null,null,null,null]], [5,  [1,0,1,0,0,1,0,0,2,2,null,null,null,null,null]], [4,  [0,4,4,4,4,0,0,0,1,1,null,null,null,null,null]], [3,  [3,3,1,3,3,4,3,3,0,0,null,null,null,null,null]], [2,  [3,2,4,2,3,4,4,4,1,1,null,null,null,null,null]], [1,  [1,1,1,1,1,2,1,1,0,0,null,null,null,null,null]]],
            seven: [[21, [1,0,1,0,1,2,2,2,4,4,null,null,null,null,null]], [20, [1,3,0,3,0,0,1,1,3,3,null,null,null,null,null]], [19, [1,2,3,2,2,0,3,3,2,2,null,null,null,null,null]], [18, [4,1,1,1,1,2,2,2,1,1,null,null,null,null,null]], [17, [3,0,1,0,3,1,2,2,4,4,null,null,null,null,null]], [16, [2,1,4,1,2,0,1,1,3,3,null,null,null,null,null]], [15, [1,0,0,0,1,1,1,1,2,2,null,null,null,null,null]], [14, [4,4,4,4,4,0,0,0,1,1,null,null,null,null,null]], [13, [3,3,4,3,3,3,4,4,0,0,null,null,null,null,null]], [12, [3,2,0,2,3,2,4,4,1,1,null,null,null,null,null]], [11, [1,1,2,1,1,1,2,2,0,0,null,null,null,null,null]], [10, [1,0,1,0,1,0,2,2,2,2,null,null,null,null,null]], [9,  [1,2,0,2,1,1,0,0,1,1,null,null,null,null,null]], [8,  [0,1,1,1,1,0,0,0,0,0,null,null,null,null,null]], [7,  [0,0,2,0,1,1,1,1,4,4,null,null,null,null,null]], [6,  [0,1,4,1,2,1,1,1,3,3,null,null,null,null,null]], [5,  [1,0,1,0,0,1,0,0,2,2,null,null,null,null,null]], [4,  [0,4,4,4,4,0,0,0,1,1,null,null,null,null,null]], [3,  [3,3,1,3,3,4,3,3,0,0,null,null,null,null,null]], [2,  [3,2,4,2,3,4,4,4,1,1,null,null,null,null,null]], [1,  [1,1,1,1,1,2,1,1,0,0,null,null,null,null,null]]],
            reg: [[21, [1,0,0,0,1,1,2,2,4,4,null,null,null,null,null]], [20, [1,3,3,3,0,1,1,1,3,3,null,null,null,null,null]], [19, [1,2,2,2,2,2,3,3,2,2,null,null,null,null,null]], [18, [4,1,1,1,1,4,4,4,4,4,null,null,null,null,null]], [17, [3,0,0,0,3,3,3,3,4,4,null,null,null,null,null]], [16, [2,1,1,1,2,2,2,2,3,3,null,null,null,null,null]], [15, [1,0,0,0,1,1,1,1,2,2,null,null,null,null,null]], [14, [0,4,4,4,4,0,0,0,1,1,null,null,null,null,null]], [13, [3,3,3,3,3,3,4,4,0,0,null,null,null,null,null]], [12, [3,2,2,2,3,2,4,4,1,1,null,null,null,null,null]], [11, [1,1,1,1,1,4,2,2,0,0,null,null,null,null,null]], [10, [1,0,0,0,1,0,2,2,2,2,null,null,null,null,null]], [9,  [1,2,2,2,1,0,0,0,1,1,null,null,null,null,null]], [8,  [0,1,1,1,1,4,0,0,0,0,null,null,null,null,null]], [7,  [0,0,0,0,1,2,1,1,4,4,null,null,null,null,null]], [6,  [0,1,1,1,2,1,1,1,3,3,null,null,null,null,null]], [5,  [1,0,0,0,0,1,0,0,2,2,null,null,null,null,null]], [4,  [0,4,4,4,4,0,0,0,1,1,null,null,null,null,null]], [3,  [3,3,3,3,3,4,3,3,0,0,null,null,null,null,null]], [2,  [3,2,2,2,3,2,4,4,1,1,null,null,null,null,null]], [1,  [1,1,1,1,1,1,1,1,0,0,null,null,null,null,null]]]
        },
        middle: {
            hazure: [[21, [3,0,0,0,4,4,1,1,1,1,null,null,null,null,null]], [20, [0,4,4,4,3,3,2,2,0,0,null,null,null,null,null]], [19, [1,3,3,3,2,2,1,1,4,4,null,null,null,null,null]], [18, [3,2,2,2,1,1,0,0,3,3,null,null,null,null,null]], [17, [3,1,1,1,0,0,3,3,2,2,null,null,null,null,null]], [16, [1,0,0,0,3,3,2,2,1,1,null,null,null,null,null]], [15, [1,3,3,3,2,2,0,0,4,4,null,null,null,null,null]], [14, [3,2,2,2,1,1,0,0,3,3,null,null,null,null,null]], [13, [3,1,1,1,0,0,2,2,2,2,null,null,null,null,null]], [12, [1,0,0,0,3,3,1,1,1,1,null,null,null,null,null]], [11, [1,3,3,3,2,2,4,4,0,0,null,null,null,null,null]], [10, [3,2,2,2,1,1,4,4,3,3,null,null,null,null,null]], [9,  [2,1,1,1,0,0,2,2,2,2,null,null,null,null,null]], [8,  [3,0,0,0,4,4,2,2,1,1,null,null,null,null,null]], [7,  [0,4,4,4,3,3,0,0,0,0,null,null,null,null,null]], [6,  [1,3,3,3,2,2,0,0,1,1,null,null,null,null,null]], [5,  [0,2,2,2,1,1,0,0,0,0,null,null,null,null,null]], [4,  [2,1,1,1,0,0,2,2,2,2,null,null,null,null,null]], [3,  [1,0,0,0,2,2,4,4,1,1,null,null,null,null,null]], [2,  [0,2,2,2,1,1,3,3,0,0,null,null,null,null,null]], [1,  [2,1,1,1,0,0,2,2,2,2,null,null,null,null,null]]],
            don: [[21, [1,0,0,0,4,4,1,1,1,1,1,1,1,3,1]], [20, [4,4,4,4,3,3,1,1,0,0,4,4,4,4,4]], [19, [4,3,3,3,2,2,0,0,4,4,4,4,4,3,4]], [18, [3,2,2,2,1,1,0,0,3,3,4,4,4,2,4]], [17, [2,1,1,1,0,0,2,2,2,2,3,3,3,1,3]], [16, [1,0,0,0,3,3,1,1,1,1,0,0,0,2,0]], [15, [0,3,3,3,2,2,0,0,4,4,0,0,0,0,0]], [14, [0,2,2,2,1,1,0,0,3,3,0,0,0,0,0]], [13, [0,1,1,1,0,0,0,0,2,2,2,2,2,2,2]], [12, [1,0,0,0,3,3,1,1,1,1,2,4,4,4,2]], [11, [2,3,3,3,2,2,4,4,0,0,4,3,3,3,1]], [10, [4,2,2,2,1,1,4,4,3,3,4,2,2,3,0]], [9,  [0,1,1,1,0,0,2,2,2,2,4,2,4,1,4]], [8,  [4,0,0,0,4,4,2,2,1,1,3,1,3,1,3]], [7,  [1,4,4,4,3,3,1,1,0,0,0,0,0,0,0]], [6,  [2,3,3,3,2,2,0,0,1,1,1,0,1,0,1]], [5,  [1,2,2,2,1,1,0,0,0,0,0,0,0,0,0]], [4,  [1,1,1,1,0,0,1,1,2,2,2,2,2,1,2]], [3,  [2,0,0,0,2,2,4,4,1,1,4,0,4,1,0]], [2,  [3,2,2,2,1,1,3,3,0,0,4,0,4,0,0]], [1,  [0,1,1,1,0,0,2,2,2,2,2,2,2,1,2]]],
            seven: [[21, [2,0,0,0,4,4,1,1,1,1,1,0,1,1,1]], [20, [1,4,4,4,3,3,2,2,0,0,4,4,4,4,4]], [19, [0,3,3,3,2,2,1,1,4,4,0,3,0,0,4]], [18, [4,2,2,2,1,1,0,0,3,3,4,2,4,4,4]], [17, [3,1,1,1,0,0,3,3,2,2,3,3,3,3,3]], [16, [2,0,0,0,3,3,2,2,1,1,0,0,0,0,0]], [15, [4,3,3,3,2,2,0,0,4,4,0,1,0,4,0]], [14, [3,2,2,2,1,1,0,0,3,3,0,0,0,4,0]], [13, [2,1,1,1,0,0,2,2,2,2,2,1,2,2,2]], [12, [4,0,0,0,3,3,4,4,1,1,4,4,4,4,4]], [11, [4,3,3,3,2,2,4,4,0,0,4,3,3,3,3]], [10, [3,2,2,2,1,1,4,4,3,3,4,2,2,2,2]], [label: 9,  [2,1,1,1,0,0,2,2,2,2,2,2,2,2,2]], [8,  [2,0,0,0,4,4,2,2,1,1,1,0,1,1,1]], [7,  [0,4,4,4,3,3,0,0,0,0,0,0,0,0,0]], [6,  [0,3,3,3,2,2,0,0,0,0,0,0,0,0,0]], [5,  [3,2,2,2,1,1,0,0,0,0,0,2,0,0,0]], [4,  [2,1,1,1,0,0,2,2,2,2,2,1,2,2,2]], [3,  [1,0,0,0,2,2,4,4,1,1,4,1,4,0,0]], [2,  [0,2,2,2,1,1,3,3,0,0,4,2,4,0,0]], [1,  [3,1,1,1,0,0,2,2,2,2,2,4,2,2,2]]],
            reg: [[21, [1,0,0,0,4,4,1,1,1,1,1,1,1,1,1]], [20, [0,4,4,4,3,3,0,0,0,0,0,4,0,0,4]], [19, [3,3,3,3,3,2,2,1,1,4,4,3,3,3,3,3]], [18, [4,2,2,2,1,1,0,0,3,3,2,2,2,2,2]], [17, [1,1,1,1,0,0,1,1,2,2,3,3,3,3,3]], [16, [2,0,0,0,3,3,2,2,1,1,0,0,0,0,0]], [15, [4,3,3,3,2,2,4,4,4,4,1,1,1,4,1]], [14, [3,2,2,2,1,1,3,3,3,3,0,0,0,3,0]], [13, [2,1,1,1,0,0,2,2,2,2,2,2,2,2,2]], [12, [1,0,0,0,3,3,1,1,1,1,4,4,4,4,4]], [11, [0,3,3,3,2,2,4,4,0,0,4,3,3,3,3]], [10, [3,2,2,2,1,1,3,3,3,3,4,2,2,2,2]], [9,  [2,1,1,1,0,0,2,2,2,2,2,2,2,2,2]], [8,  [1,0,0,0,4,4,1,1,1,1,1,1,1,1,1]], [7,  [0,4,4,4,3,3,0,0,0,0,1,1,1,1,1]], [6,  [0,3,3,3,2,2,0,0,0,0,0,0,0,0,0]], [5,  [3,2,2,2,1,1,0,0,0,0,0,2,0,2,2]], [4,  [2,1,1,1,0,0,2,2,2,2,1,1,1,1,1]], [3,  [1,0,0,0,2,2,4,4,1,1,4,0,4,0,0]], [2,  [0,2,2,2,1,1,4,4,0,0,3,3,3,3,3]], [1,  [1,1,1,1,0,0,3,3,2,2,2,2,2,2,2]]]
        },
        right: {
            hazure: [[21, [3,2,3,2,1,1,1,1,3,3,null,null,null,null,null]], [20, [2,1,2,1,0,0,2,2,2,2,null,null,null,null,null]], [19, [1,0,1,0,3,3,4,4,3,3,null,null,null,null,null]], [18, [0,4,0,4,2,2,2,2,2,2,null,null,null,null,null]], [17, [2,3,4,3,1,1,2,2,1,1,null,null,null,null,null]], [16, [1,2,3,2,0,0,0,0,0,0,null,null,null,null,null]], [15, [0,1,2,1,3,3,0,0,1,1,null,null,null,null,null]], [14, [3,0,1,0,2,2,4,4,0,0,null,null,null,null,null]], [13, [3,2,0,2,1,1,0,0,3,3,null,null,null,null,null]], [12, [1,1,2,1,0,0,4,4,2,2,null,null,null,null,null]], [11, [1,0,1,0,3,3,3,3,1,1,null,null,null,null,null]], [10, [0,4,0,4,2,2,0,0,0,0,null,null,null,null,null]], [9,  [4,3,4,3,1,1,4,4,4,4,null,null,null,null,null]], [8,  [3,2,3,2,0,0,0,0,3,3,null,null,null,null,null]], [7,  [2,1,2,1,4,4,4,4,2,2,null,null,null,null,null]], [6,  [1,0,1,0,3,3,1,1,3,3,null,null,null,null,null]], [5,  [0,3,0,3,2,2,2,2,2,2,null,null,null,null,null]], [4,  [2,2,3,2,1,1,3,3,1,1,null,null,null,null,null]], [3,  [2,1,2,1,0,0,0,0,0,0,null,null,null,null,null]], [2,  [0,0,1,0,3,3,3,3,3,3,null,null,null,null,null]], [1,  [0,3,0,3,2,2,0,0,2,2,null,null,null,null,null]]],
            don: [[21, [3,2,3,2,1,1,3,3,3,3,1,1,1,1,1]], [20, [0,1,2,1,0,0,0,0,2,2,2,2,2,2,2]], [19, [1,0,1,0,3,3,1,1,3,3,1,1,1,1,1]], [18, [0,4,0,4,2,2,0,0,2,2,0,0,0,0,0]], [17, [1,3,4,3,1,1,1,1,1,1,2,2,2,0,2]], [16, [0,2,3,2,0,0,0,0,0,0,0,4,4,4,0]], [15, [2,1,2,1,3,3,2,2,1,1,0,4,4,3,0]], [14, [2,0,1,0,2,2,4,4,0,0,2,2,2,2,2]], [13, [0,2,0,2,1,1,0,0,3,3,2,2,2,1,2]], [12, [0,1,2,1,0,0,2,2,2,2,4,0,0,0,4]], [11, [3,0,1,0,3,3,3,3,1,1,3,3,3,1,3]], [10, [0,4,0,4,2,2,0,0,0,0,2,2,2,0,2]], [9,  [1,3,4,3,1,1,1,1,4,4,3,3,3,0,3]], [8,  [3,2,3,2,0,0,3,3,3,3,0,0,0,4,0]], [7,  [4,1,2,1,4,4,4,4,2,2,1,1,1,3,1]], [6,  [1,0,1,0,3,3,1,1,3,3,0,0,0,2,0]], [5,  [2,3,0,3,2,2,2,2,2,2,2,2,2,1,2]], [4,  [3,2,3,2,1,1,3,3,1,1,3,3,3,0,3]], [3,  [4,1,2,1,0,0,4,4,0,0,4,4,4,4,4]], [2,  [3,0,1,0,3,3,3,3,3,3,3,3,3,3,3]], [1,  [2,3,0,3,2,2,2,2,2,2,2,2,2,2,2]]],
            seven: [[21, [1,2,3,2,1,1,1,1,3,3,1,0,1,1,1]], [20, [2,1,2,1,0,0,2,2,2,2,0,3,2,2,2]], [19, [4,0,1,0,3,3,4,4,3,3,2,1,2,3,3]], [18, [3,4,0,4,2,2,2,2,2,2,3,1,3,3,3]], [17, [2,3,4,3,1,1,2,2,1,1,2,3,2,1,2]], [16, [3,2,3,2,0,0,0,0,0,0,0,4,4,4,0]], [15, [0,1,2,1,3,3,0,0,1,1,0,3,4,4,0]], [14, [1,0,1,0,2,2,4,4,0,0,2,2,2,2,2]], [13, [0,2,0,2,1,1,0,0,3,3,2,3,2,2,2]], [12, [4,1,2,1,0,0,4,4,4,4,4,4,4,0,4]], [11, [3,0,1,0,3,3,3,3,3,3,3,3,3,1,3]], [10, [2,4,0,4,2,2,2,2,2,2,2,2,2,2,2]], [9,  [3,3,4,3,1,1,1,1,1,1,3,1,1,3,3]], [8,  [0,2,3,2,0,0,0,0,0,0,0,0,0,0,0]], [7,  [0,1,2,1,4,4,4,4,1,1,1,1,1,1,1]], [6,  [0,0,1,0,3,3,1,1,3,3,0,0,0,0,0]], [5,  [2,3,0,3,2,2,2,2,2,2,2,0,2,2,2]], [4,  [3,2,3,2,1,1,3,3,1,1,3,3,3,3,3]], [3,  [0,1,2,1,0,0,0,0,0,0,0,2,0,0,0]], [2,  [1,0,1,0,3,3,3,3,3,3,3,2,3,3,3]], [1,  [0,3,0,3,2,2,0,0,2,2,2,1,2,2,2]]],
            reg: [[21, [1,0,0,0,1,1,2,2,4,4,null,null,null,null,null]], [20, [1,3,3,3,0,1,1,1,3,3,null,null,null,null,null]], [19, [1,2,2,2,2,2,3,3,2,2,null,null,null,null,null]], [18, [4,1,1,1,1,4,4,4,4,4,null,null,null,null,null]], [17, [3,0,0,0,3,3,3,3,4,4,null,null,null,null,null]], [16, [2,1,1,1,2,2,2,2,3,3,null,null,null,null,null]], [15, [1,0,0,0,1,1,1,1,2,2,null,null,null,null,null]], [14, [0,4,4,4,4,0,0,0,1,1,null,null,null,null,null]], [13, [3,3,3,3,3,3,4,4,0,0,null,null,null,null,null]], [12, [3,2,2,2,3,2,4,4,1,1,null,null,null,null,null]], [11, [1,1,1,1,1,4,2,2,0,0,null,null,null,null,null]], [10, [1,0,0,0,1,0,2,2,2,2,null,null,null,null,null]], [9,  [1,2,2,2,1,0,0,0,1,1,null,null,null,null,null]], [8,  [0,1,1,1,1,4,0,0,0,0,null,null,null,null,null]], [7,  [0,0,0,0,1,2,1,1,4,4,null,null,null,null,null]], [6,  [0,1,1,1,2,1,1,1,3,3,null,null,null,null,null]], [5,  [1,0,0,0,0,1,0,0,2,2,null,null,null,null,null]], [4,  [0,4,4,4,4,0,0,0,1,1,null,null,null,null,null]], [3,  [3,3,3,3,3,4,3,3,0,0,null,null,null,null,null]], [2,  [3,2,2,2,3,2,4,4,1,1,null,null,null,null,null]], [1,  [1,1,1,1,1,1,1,1,0,0,null,null,null,null,null]]]
        }
    };

    function buildL() {
        const target = document.getElementById('stripL');
        target.innerHTML = '';
        const imgNum = currentReel === 'left' ? 1 : currentReel === 'middle' ? 2 : 3;
        for(let s=0; s<3; s++) {
            reelArray.forEach(num => {
                const d = document.createElement('div');
                d.className = 'symbol';
                d.style.backgroundImage = `url('reel${imgNum}.png')`;
                d.style.backgroundPosition = `0 ${(21-num)*5}%`;
                target.appendChild(d);
            });
        }
    }

    function drawR(midNum) {
        const stripR = document.getElementById('stripR');
        stripR.innerHTML = '';
        const imgNum = currentReel === 'left' ? 1 : currentReel === 'middle' ? 2 : 3;
        [2, 1, 0, -1, -2].forEach(offset => {
            let num = midNum + offset;
            while(num > 21) num -= 21;
            while(num < 1) num += 21;
            const d = document.createElement('div');
            d.className = 'symbol';
            d.style.backgroundImage = `url('reel${imgNum}.png')`;
            d.style.backgroundPosition = `0 ${(21-num)*5}%`;
            stripR.appendChild(d);
        });
    }

    const winL = document.getElementById('winL');
    winL.onscroll = () => {
        const centerPos = winL.scrollTop + (sH * 2.5);
        const rawIdx = Math.floor(centerPos / sH) % 21;
        selectedIdx = reelArray[rawIdx];
        if(winL.scrollTop < sH * 5) winL.scrollTop += sH * 21;
        if(winL.scrollTop > sH * 37) winL.scrollTop -= sH * 21;
        document.getElementById('val-mid').innerText = selectedIdx;
    };

    function executeControl() {
        const reelRows = GOD_DATA[currentReel][currentState];
        if (!reelRows) return;

        // リール番号(selectedIdx)と一致する行を特定
        const targetRow = reelRows.find(row => {
            // オブジェクトのプロパティまたは配列の最初の要素をチェック
            return row[0] === selectedIdx || row.label === selectedIdx;
        });
        if (!targetRow) return;

        // targetRow[1]がスベリ配列であることを前提とする
        const slips = Array.isArray(targetRow[1]) ? targetRow[1] : targetRow.data;
        const slip = slips ? slips[selectedFlagIdx] : 0;
        const slipVal = (slip === null || typeof slip === 'undefined') ? 0 : slip;

        let stopMid = selectedIdx + slipVal;
        if (stopMid > 21) stopMid -= 21;
        
        document.getElementById('val-slip').innerText = (slip === null ? "--" : slip);
        document.getElementById('val-res').innerText = stopMid;
        
        drawR(stopMid);
    }

    function setReel(id) {
        document.querySelectorAll('.btn').forEach(b => { if(b.id.startsWith('rb-')) b.classList.remove('active'); });
        document.getElementById('rb-' + id).classList.add('active');
        currentReel = id; buildL();
        const initialMap = { left: 8, middle: 15, right: 3 };
        const initNum = initialMap[id];
        const initScroll = sH * (21 + (21 - initNum + 21) - 2);
        winL.scrollTo({ top: initScroll, behavior: 'auto' });
        drawR(initNum);
        document.getElementById('val-mid').innerText = initNum;
    }

    function setState(id) {
        document.querySelectorAll('.btn').forEach(b => { if(b.id.startsWith('st-')) b.classList.remove('active'); });
        document.getElementById('st-' + id).classList.add('active');
        currentState = id;
    }

    function setFlag(idx, btn) {
        document.querySelectorAll('.f-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedFlagIdx = idx;
    }

    window.onload = () => { setReel('left'); setState('hazure'); };
</script>
</body>
</html>